<div class="samples-wrapper">
  <div class="name-actions">
    <h1><%= @sample.name %></h1>
    <h5><%= @sample.created_at.strftime("%Y-%m-%d") %></h5>
    <div class="stats">
      <div>
        <span><%= @likes %></span>
        <%= image_tag 'like-dark.svg' %>
      </div>
      <div>
        <span><%= @downloads %></span>
        <%= image_tag 'download-dark.svg' %>
      </div>
    </div>
    <div class="actions">
      <% if current_user && !(current_user.id == @sample.user_id) %>
        <% if !@downloaded %>
          <%= link_to 'download', download_sample_path(@sample.id) %>
        <% else %>
          <%= link_to 'download', rails_blob_url(@sample.audio_file) %>
        <% end %>
      <% end %>
      <% if current_user && current_user.id == @sample.user_id %>
        <%= link_to 'download', rails_blob_url(@sample.audio_file) %>
        <%= link_to 'edit', edit_sample_path(@sample), class: 'edit' %>
      <% end %>
      <% if current_user %>
        <% if !@liked %>
          <%= button_to 'like', like_sample_path(@sample.id), method: :post %>
        <% else %>
          <%= button_to 'unlike', unlike_sample_path(@sample.id), method: :delete %>
        <% end %>
      <% end %>
    </div>
  </div>
  <audio class="preview" controls controlsList="nodownload" preload="metadata">
    <source src="<%= rails_blob_url(@sample.audio_file) %>" type="<%= @sample.audio_file.content_type %>">
  </audio>
  <% if @sample.tag_list.count != 0 %>
    <div class="tags">
      <% @sample.tag_list.each do |tag| %>
        <%= link_to "##{tag}",  show_tag_path(tag) %>
      <% end %>
    </div>
  <% end %>
  <div class="description">
    <h2>Description</h2>
    <% if @sample.description %>
      <p><%= @sample.description %></p>
    <% else %>
      <p>No description...</p>
    <% end %>
  </div>
  <div class="properties">
    <h2>Properties</h2>
    <div class="property">
      <div class="name">duration</div>
      <div class="value"><%= @sample.duration %></div>
    </div>
    <div class="property">
      <div class="name">bit depth</div>
      <div class="value"><%= @sample.bit_depth %></div>
    </div>
    <div class="property">
      <div class="name">sample rate</div>
      <div class="value"><%= @sample.sample_rate %>Hz</div>
    </div>
  </div>
  <% if current_user && current_user.id == @sample.user_id %>
    <div class="danger-zone">
      <h2>DANGER ZONE</h2>
      <div class="actions">
        <%= link_to 'DELETE SAMPLE', delete_sample_path(@sample), method: :delete %>
      </div>
    </div>
  <% end %>
  <% if !(current_user && current_user.id == @creator.id) %>
    <div class="creator">
      <h3>Created by <%= link_to "@#{@creator.username}", creator_path(@creator.username) %></h3>
    </div>
  <% end %>
  <div class="comments-wrapper">
    <h2>Comments</h2>
    <% if current_user %>
      <%= form_with class: 'new-comment', url: sample_comments_path(@sample.id), model: @comment do |form| %>
        <%= form.rich_text_area :content %>
        <%= form.submit 'comment' %>
      <% end %>
    <% end %>
    <% @comments_info.each do |info| %>
      <div class="comment-card">
        <div class="user">
          <%= image_tag info[:user].avatar %>
          <div class="details">
            <h5>@<%= info[:user].username %></h5>
            <span><%= info[:comment].created_at.strftime("%Y-%m-%d") %>
          </div>
        </div>
        <%= info[:comment].content %>
        <% if info[:comment].user_id == current_user.id %>
          <div class="actions">
            <%= link_to 'edit', edit_sample_comment_path(sample_id: info[:comment].sample_id, comment_id: info[:comment].id) %>
            <%= button_to 'delete', delete_sample_comment_path(sample_id: info[:comment].sample_id, comment_id: info[:comment].id), method: :delete %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>